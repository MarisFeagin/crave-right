<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crave Right</title>
    <link rel="style" href="./assets/css/style.css">
</head>
<body>
    <!--Header-->
    <h3 class="header">Crave Right</h3>
    <!--About-->
<!--Map Search-->
<main>
  <h1>Crave Right Database Entry:</h1>
  <h2>Nutrition Information</h2>
  <form id="labelForm">
    <input type="text" id="productName" placeholder="Product Name" required />
    <input type="text" id="servingSize" placeholder="Serving Size" required />
    <input type="number" id="calories" placeholder="Calories" required />
    <button type="submit">Add/Update Label</button>
</form>
<div id="labelsList"></div>
</main>
    <!--Contact-->

    <!--Footer-->
    <footer class="nav">
        <div class="nav-content">
          <h3 class="nav-header">Crave Right&trade;</h3>
           <div class="nav-list">
             <ul class="nav-list">
               <li class="nav-list-item"><a href="">About</a></li>
               <li class="nav-list-item"><a href="">Contact</a></li>
             </ul>
           </div>
           <p class="nav-p">&copy; All Rights Reserved Crave Right, 2024</p>
        </div>
     </footer>
     
    <!--Javascript-->
     <script>
      const labelsList = document.getElementById('labelsList');
      const labelForm = document.getElementById('labelForm');
      let editingLabelId = null; // Store the ID of the label being edited


      async function fetchLabels() {
          const response = await fetch('http://localhost:3000/api/labels');
          const labels = await response.json();
          displayLabels(labels);
      }

      function displayLabels(labels) {
    console.log('Displaying labels:', labels); // Log the labels being displayed
    labelsList.innerHTML = '';
    labels.forEach(label => {
        const div = document.createElement('div');
        div.innerHTML = `
            <h3>${label.productName}</h3>
            <p>Serving Size: ${label.servingSize}</p>
            <p>Calories: ${label.nutrients.calories}</p>
            <button onclick="editLabel(${label.id})">Edit</button>
        `;
        labelsList.appendChild(div);
    });
}

labelForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const newLabel = {
        productName: document.getElementById('productName').value,
        servingSize: document.getElementById('servingSize').value,
        nutrients: {
            calories: parseInt(document.getElementById('calories').value),
        }
    };

    let response;

    if (editingLabelId) {
        // Update existing label
        response = await fetch(`http://localhost:3000/api/labels/${editingLabelId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newLabel),
        });

        editingLabelId = null; // Reset the editing state
    } else {
        // Create new label
        response = await fetch('http://localhost:3000/api/labels', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newLabel),
        });
    }

    if (response.ok) {
        labelForm.reset();
        fetchLabels(); // Refresh the list after creating or updating
    } else {
        console.error('Failed to save label');
    }
});


async function editLabel(id) {
    console.log(`Editing label with ID: ${id}`);
    try {
        const response = await fetch(`http://localhost:3000/api/labels/${id}`);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const label = await response.json();
        document.getElementById('productName').value = label.productName;
        document.getElementById('servingSize').value = label.servingSize;
        document.getElementById('calories').value = label.nutrients.calories;

        // Change button text to indicate update
        labelForm.querySelector('button').textContent = 'Update Label';

        // Set the editing label ID
        editingLabelId = label.id;
    } catch (error) {
        console.error('Error fetching label:', error);
    }
}


      // Initial fetch
      fetchLabels();
  </script>
</body>
</html>